<html>
    <head>
        <!-- linking the external files from font awesome and vuejs-->
        <link rel="stylesheet"href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
        <script src = "https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

        <!-- linking the lesson plan script-->
        <script src="lessons.js"></script>
        <style>
            body{
                margin:0;
            }
            #lessonBlock{
                background-color: black;
                color:white;
                padding:35px;
                width:15%;
                height:30%;
                margin:2%;
                border:3%;

            }
            #checkoutLessons{
                background-color:black;
                color:white;
                width:90%;
                padding:10px;
                margin:15px;
                border-radius: 8px 8px 8px 8px;
            }
        </style>

    </head>
    <body>

        <!-- Container Div-->
        <div id="lessonplanapp">
            <!-- Shoppping Cart Button -->
            <div>
                <button v-if="cartAggregate > 0" v-on:click="showCheckout()">
                    <!-- create logic to switch between checkout and lesson plan? -->
                    {{cartAggregate}} Checkout
                </button>
                <button v-else disabled>
                    <!-- create logic to switch between checkout and lesson plan? -->
                    {{cartAggregate}} Checkout
                </button>

            </div>


            <!-- Main Body -->
            <!-- Lesson Plans Division-->
            <div v-if="checkoutLogic" id="lessonDisplayDiv">

                <!-- Page Subtile -->
                <div><span style="font-weight: bold; font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif; font-size: x-large;" v-text="lessonsub"></span></div>

                <!-- ||||||||||| ADD font awesome icon  ||||||||||| -->
                <!-- Displaying Lessons individually -->
                <div id="lessonBlock" v-for="lesson in lessons" style="display:inline-block;">
                    <div v-if="lesson.showLesson">
                        <!-- lesson information -->
                        <h2 v-text="lesson.Subject"></h2>
                        <img style="width:50px;height:50px" v-bind:src="lesson.image">
                        <h4 v-text="lesson.Location"></h4>
                        <h4 v-text="lesson.price"></h4>

                        <!-- Cart Button -->
                        <button v-if="canAddTocart(lesson)" v-on:click="addtoCart(lesson)">
                            Add To Cart
                        </button>
                        <button v-else disabled>
                            Add To Cart
                        </button>

                        <!-- product count message-->
                        <span v-if="canAddTocart(lesson) == false ">
                            All Spaces Booked!
                        </span>
                        <!-- only less than 3 left -->
                        <span v-else-if="lesson.spaces - quantityAgg(lesson) <= 3">Only {{lesson.spaces}} Spaces Left! </span>
                        
                    </div>

                </div>

                {{cart}}

            </div>

            <!-- Checkout and Shopping Cart Division -->
            <div id="cartDisplayDiv" v-else>
                <!-- Page Subtile -->
                <div><span style="font-weight: bold; font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif; font-size: x-large;" v-text="checkoutsub"></span></div>

                <!-- Lesson list of added lessons -->
                <!-- need to change and display an item only once in the cart -->
                <div v-for="item in cart" id="checkoutLessons">
                    <!-- Lesson Details displayed -->
                    <span v-text="item.Subject"></span>
                    <span style="margin-left:200px;"> Location: <span v-text="item.Location"></span></span>
                    <div>
                        <span>Price Per Lesson: <span v-text = "item.price"></span></span>
                        <span style="margin-left:200px"> Spaces Chosen: <span v-text="item.quantity"></span></span>
                    </div>

                    <!-- Removal Button -->
                    <button v-on:click="remove(item)">
                        Remove a Space
                    </button>
                </div>

            </div>

        </div>


        <!-- Vuejs Script -->
        <script type="text/javascript">
            var webstore = new Vue({
                el:lessonplanapp,
                data:{
                    lessonsub: 'Browse Our Lesson Catalogue',
                    lessons:lessons,
                    checkoutLogic: true,
                    cart:[],
                    checkoutsub: 'Your Shopping Cart'

                },
                methods:{
                    canAddTocart: function(course) {
                        if (course.spaces > 0){
                            return true;
                        }
                        else {
                            return false;
                        }
                    },
                    // addtoCart: function(course) {
                    //     let itemInCart;
                    //     let itemId;

                    //     for (i = 0; i <= this.cart.length; i++){
                    //         if (cart[i].id === course.id){
                    //             itemInCart = true;
                    //             itemId = cart[i].id;
                    //         }
                    //         else {
                    //             itemInCart = false;
                    //         }
                    //     }

                    //     if (!itemInCart){
                    //         let lessonToCart = {
                    //             "id" : course.id,
                    //             "Subject" : course.Subject,
                    //             "price" : course.price,
                    //             "image" : course.image,
                    //             "Location" : course.Location,
                    //             "spacesReserved": 1
                    //         }
                    //         this.cart.push(lessonToCart);
                    //         course.spaces = course.spaces - 1;
                    //     }
                    //     else {
                    //         cart[itemId].spacesReserved = cart[itemId].spacesReserved + 1;
                    //         course.spaces = course.spaces - 1;
                    //     }
                    // },

                    addtoCart: function(course){
                        this.cart.push(course);
                        course.quantity = course.quantity + 1;
                        course.spaces = course.spaces - 1;
                    },

                    showCheckout: function() {
                        this.checkoutLogic ? this.checkoutLogic = false : this.checkoutLogic = true;
                    },

                    remove: function(course){
                        //if there's 1 quantity, then remove quantity from cart
                        let indexfound = false;
                        if (course.quantity == 1 ){
                            this.cart.splice(this.cart.indexOf(course),1);
                        }

                        course.quantity = course.quantity - 1;
                        course.spaces = course.spaces + 1;

                    },
                    quantityAgg : function(course){
                        return course.quantity;
                    }

                },
                computed:{
                    cartAggregate: function(){
                        return this.cart.length;
                    }
                }
            })
        </script>


    </body>
</html>